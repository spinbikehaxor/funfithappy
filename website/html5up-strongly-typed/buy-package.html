<!DOCTYPE HTML>
<!--
	Strongly Typed by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Packages</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" /> 
		<link rel="stylesheet" href="assets/css/main.css" />
		<style>
			ul.no-bullets {
			  list-style-type: none;
			  margin: 0;
			  padding: 0;
			}
		</style>
	</head>
	<body class="no-sidebar is-preload">
		<script src="https://www.paypal.com/sdk/js?client-id=ARFAJ4v0DMU0-jp__jkVEVNYP139DlETKokloLrUywQ0qjlOs0H5x1ETIVDJARd3rBuCPJHGKWrdZ2fY&vault=true" data-sdk-integration-source="button-factory"></script>
  </script>
		<div id="page-wrapper">

			<!-- Header -->
				<section id="header">
					<div class="container">

						<!-- Logo -->
							<h1 id="logo"><a href="index.html">Buy A Package</a></h1>
							<p><strong><span id ="subscription">Page Loading...Please Wait</span><strong></p>
					

						<!-- Nav -->
							<nav id="nav">
								<ul>
									<li><a class="icon solid fa-home" href="home.html"><span>Home</span></a></li>
									<li><a class="icon solid fa-sitemap" href="user-info.html"><span>Your Account</span></a></li>
									<li><a class="icon solid fa-sitemap" href="buy-package.html"><span>Buy A Package</span></a></li>
									<li>
										<a href="#" class="icon fa-chart-bar"><span>High Fitness</span></a>
										<ul>
											<li><a href="high-live-list.html">Book a Live Class</a></li>
											<li><a href="high-fitness.html">Online Streaming</a></li>
										</ul>
									</li>
									<li><a class="icon solid fa-retweet" href="boot-camp.html"><span>Boot Camp</span></a></li>
									<li><a class="icon solid fa-sitemap" href="javascript:signOut()"><span>Sign Out</span></a></li>
								</ul>
							</nav>

					</div>
				</section>

			<!-- Main -->
				<section id="main">
					<div class="container">
						<div id="content">

							<!-- Post -->
								<article class="box post">
									<header>
										<h2>Live and Streaming Packages</h2>
									</header>
									<span class="image featured"><img src="images/HighJump2.jpg" alt="" /></span>

									<ul class="no-bullets">
										<li>
											<button id="streamingButton" onclick="javascript:togglePackage('streaming')">1 Month Unlimited Streaming - $20</button>
										</li>
										<li>
											<button onclick="javascript:togglePackage('live')">1 Live Class - $10</button>
										</li>
										<li>
											<button onclick="javascript:togglePackage('4live')">4 Live Classes - $35</button>
										</li>
										<li>
											<button onclick="javascript:togglePackage('10live')">10 Live Classes - $85</button>
										</li>
									</ul>
								
								<div id="streaming" style="display:none">
									<p>
									<h3>1 Month Unlimited Streaming - $20</h3>
									<p> With this package, you'll have access to all High Replays as well as Annie's Bootcamp videos. 
									<p>Current streaming times for High are:
										<ul>
											<li>Tuesdays at 10am and 6pm</li>
											<li>Thursdays at 10am and 6pm</li>
											<li>Sundays at 10am</li>
										</ul>
									<p>
									<div id="paypal-button-container"></div>
									<script>
								      paypal.Buttons({
									      style: {
									          shape: 'rect',
									          color: 'silver',
									          layout: 'vertical',
									          label: 'subscribe',
									          
									      },
								        createSubscription: function(data, actions) {
								          return actions.subscription.create({
								            'plan_id': 'P-40S89537VJ958872PL4SJ2CA' // Creates the subscription
								          });
								        },
								        onApprove: function(data, actions) {
								          // data.subscriptionID); // Optional message given to subscriber
								          xmlRequest(data);
								          }
								      }).render('#paypal-button-container'); // Renders the PayPal button
								    </script>
								   </p>
								</p>
							</p>
						</div>
							<div id="live" style="display:none">
								<p>
									<h3>1 Live Class - $10</h3>
									<p>Purchase a credit for 1 live class with Annie and Cassie!
									<p>
									<div id="paypal-button-container-live"></div>
										<script>
									      paypal.Buttons({
									        createOrder: function(data, actions) {
									        	console.log("in createOrder")
									          return actions.order.create({
									            purchase_units: [{
									              amount: {
									                value: '10.00'
									              }
									            }]
									          });
									        },
									        onApprove: function(data, actions) {
									        	console.log("in onApprove")
									          return actions.order.capture().then(function(details) {
									            //alert('Transaction Details ' + details);
									            buyLive(details)
									          });
									        }
									      }).render('#paypal-button-container-live');
									  </script>
									</p>
								</p>
							</div>
							<div id="4live" style="display:none">
								<p>
									<h3>4 Live Classes - $35</h3>
									<p>Purchase discounted credits for 4 live classes with Annie and Cassie!
									<p>
									<div id="paypal-button-container-4live"></div>
										<script>
									      paypal.Buttons({
									        createOrder: function(data, actions) {
									          return actions.order.create({
									            purchase_units: [{
									              amount: {
									                value: '35.00'
									              }
									            }]
									          });
									        },
									        onApprove: function(data, actions) {
									          return actions.order.capture().then(function(details) {
									          		buyLive(details)
									          });
									        }
									      }).render('#paypal-button-container-4live');
									  </script>
									</p>
								</p>
							</div>
							<div id="10live" style="display:none">
								<p>
									<h3>10 Live Classes - $85</h3>
									<p>Purchase discounted credits for 10 live classes with Annie and Cassie!
									<p>
									<div id="paypal-button-container-10live"></div>
										<script>
									      paypal.Buttons({
									        createOrder: function(data, actions) {
									          return actions.order.create({
									            purchase_units: [{
									              amount: {
									                value: '85.00'
									              }
									            }]
									          });
									        },
									        onApprove: function(data, actions) {
									          return actions.order.capture().then(function(details) {
									          		buyLive(details)
									          });
									        }
									      }).render('#paypal-button-container-10live');
									  </script>
									</p>
								</p>
							</div>
								</article>

						</div>
					</div>
				</section>
		</div>

<!-- Scripts -->

<script>
window.onload = getSubscriptionStatus()
function parseCookie()
{
	jwt = document.cookie.split('; ')
  	.find(row => row.startsWith('auth'))
  	.split('=')[1];

  	return jwt;
}

function togglePackage(divname)
{
	if(divname == "streaming")
	{
		document.getElementById("live").style.display = "none"
		document.getElementById("4live").style.display = "none"
		document.getElementById("streaming").style.display = "block"
		document.getElementById("10live").style.display = "none"
	}
	else if(divname == "live")
	{
		document.getElementById("streaming").style.display = "none"
		document.getElementById("live").style.display = "block"
		document.getElementById("4live").style.display = "none"
		document.getElementById("10live").style.display = "none"
	}
	else if(divname == "4live")
	{
		document.getElementById("streaming").style.display = "none"
		document.getElementById("live").style.display = "none"
		document.getElementById("4live").style.display = "block"
		document.getElementById("10live").style.display = "none"
	}
	else if(divname == "10live")
	{
		document.getElementById("streaming").style.display = "none"
		document.getElementById("live").style.display = "none"
		document.getElementById("4live").style.display = "none"
		document.getElementById("10live").style.display = "block"
	}	
}


function getSubscriptionStatus()
{
	if (document.cookie.length == 0)
	{
		window.location.replace("sign-in.html")
	}
	
	var postRequest = new XMLHttpRequest()

	postRequest.open('POST', 'https://zkhudp5vdk.execute-api.us-east-2.amazonaws.com/default/any', true)
	postRequest.setRequestHeader('Content-type', 'application/json;charset=UTF-8');
	postRequest.setRequestHeader('X-Api-Key', parseCookie())
	//postRequest.withCredentials = true;
	
	postRequest.onload = function () 
	{
	  // Begin accessing JSON data here
	  var responseData = JSON.parse(this.response)

	  if (postRequest.status >= 200 && postRequest.status < 400) 
	  {
	  		hasSubscription(postRequest.responseText)
	  }
	  else 
	  {
	  	alert(postRequest.responseText)
	  }
	}

	postRequest.send()

	//getBlackFridayEligibility()
}

/* Commenting out until next year!
function getBlackFridayEligibility()
{
	var postRequest = new XMLHttpRequest()

	postRequest.open('POST', 'https://c3lmitn82d.execute-api.us-east-2.amazonaws.com/default/any', true)
	postRequest.setRequestHeader('Content-type', 'application/json;charset=UTF-8');
	postRequest.setRequestHeader('X-Api-Key', parseCookie())
	//postRequest.withCredentials = true;
	
	postRequest.onload = function () 
	{
	  // Begin accessing JSON data here
	  var responseData = JSON.parse(this.response)

	  if (postRequest.status != 200) 
	  {
	  		console.log("Not eligible for Black Friday " + postRequest.responseText)
	  		document.getElementById("blackFridayButton").style.display = "none"
	  }
	}

	postRequest.send()
}*/

function hasSubscription(userdata)
{
	json = JSON.parse(userdata);

	hasCurrentPayment = false;
	if(json.isPaymentCurrent == "ACTIVE")
	{
		document.getElementById("subscription").textContent="Active Streaming Subscription On File"
		document.getElementById("streamingButton").style.display = "none"
	}
	else
	{
		document.getElementById("subscription").textContent="Live And Streaming Classes"
	}
}

function xmlRequest(data)
{
	var postRequest = new XMLHttpRequest()

	postRequest.open('POST', 'https://7s6z0gkda0.execute-api.us-east-2.amazonaws.com/default/any', true)
	postRequest.setRequestHeader('Content-type', 'application/json;charset=UTF-8');
	postRequest.setRequestHeader('X-Api-Key', parseCookie())
	
	postRequest.onload = function () 
	{
	  // Begin accessing JSON data here
	  var responseData = JSON.parse(this.response)

	  if (postRequest.status >= 200 && postRequest.status < 400) 
	  {
	  		alert("Purchase Complete!")
	  		window.location.replace("../user-info.html")
	  }
	  else 
	  {
	  	alert(postRequest.responseText)
	  }
	}

	postRequest.send(JSON.stringify(data))
}

function buyLive(data)
{
	//console.log("in buyLive " + JSON.stringify(data))
	console.log("in buyLive")
	var postRequest = new XMLHttpRequest()

	postRequest.open('POST', 'https://a2wfx5q809.execute-api.us-east-2.amazonaws.com/default/any', true)
	postRequest.setRequestHeader('Content-type', 'application/json;charset=UTF-8');
	postRequest.setRequestHeader('X-Api-Key', parseCookie())
	
	postRequest.onload = function () 
	{
	  // Begin accessing JSON data here
	  var responseData = JSON.parse(this.response)

	  if (postRequest.status >= 200 && postRequest.status < 400) 
	  {
	  		alert("Purchase Complete!")
	  		window.location.replace("../user-info.html")
	  }
	  else 
	  {
	  	alert(postRequest.responseText)
	  }
	}

	postRequest.send(JSON.stringify(data))
	//window.location.reload()
}


function signOut()
{
	document.cookie = 'auth=' + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
	window.location.replace("index.html");
}
</script>

<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/jquery.dropotron.min.js"></script>
<script src="assets/js/browser.min.js"></script>
<script src="assets/js/breakpoints.min.js"></script>
<script src="assets/js/util.js"></script>
<script src="assets/js/main.js"></script>

	</body>
</html>