<!DOCTYPE HTML>
<!--
	Strongly Typed by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>User Profile</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<style>
			input:disabled {
    			color: black;
			}
			.scrollingTable {
	            overflow-y: scroll;
	            width: 100%;
	        }
			.visible-scrollbar::-webkit-scrollbar-thumb {
			  overflow: -moz-scrollbars-vertical; 
			  overflow: scroll;
			  height: 2em;
			}
			::-webkit-scrollbar {
			  -webkit-appearance: none;
			  width: 7px;
			}
			::-webkit-scrollbar-thumb {
			  background-color: rgba(0, 0, 0, .5);
			  -webkit-box-shadow: 0 0 1px rgba(255, 255, 255, .5);
			}
		</style>
	</head>
	<body class="no-sidebar is-preload">
		<div id="page-wrapper">

			<!-- Header -->
				<section id="header">
					<div class="container">

						<!-- Logo -->
							<h1 id="logo"><a href="index.html"></a>Annie Cassie Fit</h1>
							<p><strong><span id ="status">Page Loading... Please Wait</span></strong></p>

						<!-- Nav -->
							<nav id="nav">
								<ul>
									<li><a class="icon solid fa-home" href="home.html"><span>Home</span></a></li>
									<li><a class="icon solid fa-sitemap" href="user-info.html"><span>Your Account</span></a></li>
									<li><a class="icon solid fa-sitemap" href="buy-package.html"><span>Buy A Package</span></a></li>
									<li>
										<a href="#" class="icon fa-chart-bar"><span>High Fitness</span></a>
										<ul>
											<li><a href="high-live-list.html">Book a Live Class</a></li>
											<li><a href="high-fitness.html">Online Streaming</a></li>
										</ul>
									</li>
									<li><a class="icon solid fa-retweet" href="boot-camp.html"><span>Boot Camp</span></a></li>
									<li><a class="icon solid fa-sitemap" href="javascript:signOut()"><span>Sign Out</span></a></li>
								</ul>
							</nav>

							<div id="waiver-link" style="display:none">
								<section>
										<div></div>
										<p>
										<div>
											<div>
												<a href="../waiver.html"><span>Please Complete Waiver</span></a>
											</div>	
											
										</div>

								</section>
								</div>
							</div>
						</section>

					</div>
				</section>

			<!-- Main -->
				<section id="main">
					<div class="container">

						<div class="row">
							<div class="col-6 col-12-medium">
								<section>
									<form method="post" action="https://1fuqo5lkh6.execute-api.us-east-2.amazonaws.com/default/any">
										<div class="row gtr-50">
											<div class="col-6 col-12-small">
												<label for="username">Username</label>
												<input disabled name="username" id="username" placeholder="Username" type="text" />
											</div>
											<div class="col-6 col-12-small">
												<label for="username">First Name</label>
												<input disabled name="fname" id="fname" type="text" />
											</div>
											<div class="col-6 col-12-small">
												<label for="username">Last Name</label>
												<input disabled name="lname" id="lname" type="text" />
											</div>
											<div class="col-6 col-12-small">
												<label for="username">Email</label>
												<input disabled name="email" id="email" type="text" />
											</div>
											<div class="col-6 col-12-small">
												<label for="username">Phone</label>
												<input disabled name="phone" id="phone" type="text" />
											</div>
											<div class="col-6 col-12-small">
												<label id="waiver-label" for="waiver">Waiver Signed Date</label>
												<div id="waiver-div"><input disabled name="waiver" id="waiver" type="text" /></div>
											</div>
											<div class="col-6 col-12-small">
												<label for="payment">Next Scheduled Payment</label>
												<input disabled name="payment" id="payment" type="text" />
											</div>
											<div class="col-6 col-12-small">
												<label for="payment">Available Live Class Credits</label>
												<input disabled name="credits" id="credits" type="text" />
											</div>
										</div>
									</form>
								</section>
							</div>
							<div class="col-6 col-12-medium">
								<section>
										<div class="row gtr-50">
											<div class="col-6 col-12-small" id="streaming-link" style="display:none">
										
												<a href="high-fitness.html">
													<span><strong>Approved For Streaming!</strong></span>
												</a>
											</div>	
											<p>
										</div>
									<div class="row gtr-50">
											<div class="col-6 col-12-small">
										
												
											</div>	
											<p>
										</div>
									<div class="row gtr-50" id="pay-history-div">
										<div class="col-6 col-12-medium">
											<h3>Live Class Payments</h3>
											<table id="paymentHistory">
												   <tr>
												      <th>Date</th>
												      <th>Amount</th>
												      <th>Credits</th>
												   </tr>
											</table>
										</div>
									</div>
								</section>
							</div>
								
						</div>
						<div class="row gtr-50" id="class-history-div"><p></p></div>
						<div class="row gtr-50" id="class-history-div">

									<div class="col-6 col-12-medium">
											<h3 id="classHistoryHeader">Class History:</h3>
											<div class="scrollingTable visible-scrollbar">
												<table id="streamHistory">
													   <tr>
													      <th>Date</th>
													      <th>Time</th>
													      <th>Class Type</th>
													      <th>Class Name</th>
													   </tr>
												</table>
											</div>
											<p id="scrollHint" style="display:none"><em>Scroll for more</em></p>
									</div>
						</div>
							

			<!-- Footer -->
				
					<div id="copyright" class="container">
						<ul class="links">
							<li>&copy; Annie Cassie Fit. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
						</ul>
					</div>
				</section>

		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.dropotron.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

<script>


window.onload = xmlRequest()


function makeTableScroll(tablename) 
{
	
    var maxRows = 4;

    var table = document.getElementById(tablename);
    var wrapper = table.parentNode;
    var rowsInTable = table.rows.length;
    var height = 0;
    if (rowsInTable > maxRows) {
        for (var i = 0; i < maxRows; i++) {
            height += table.rows[i].clientHeight;
        }
        wrapper.style.height = height + "px";
        document.getElementById('scrollHint').style.display="block"

    }
}

function parseCookie()
{
	cookiestring = document.cookie;
	if(cookiestring.length == 0)
	{
		window.location.replace("sign-in.html")
	}
	jwt = document.cookie.split('; ')
  	.find(row => row.startsWith('auth'))
  	.split('=')[1];

  	return jwt;
}

function xmlRequest()
{
	var postRequest = new XMLHttpRequest()

	postRequest.open('POST', 'https://zkhudp5vdk.execute-api.us-east-2.amazonaws.com/default/any', true)
	postRequest.setRequestHeader('Content-type', 'application/json;charset=UTF-8');

	authCookie =  parseCookie()
	postRequest.setRequestHeader('X-Api-Key', parseCookie())
	//postRequest.withCredentials = true;
	
	postRequest.onload = function () 
	{
	  // Begin accessing JSON data here
	  var responseData = JSON.parse(this.response)

	  if (postRequest.status >= 200 && postRequest.status < 400) 
	  {
	  		//alert("success! " + postRequest.responseText)
	  		populatePage(postRequest.responseText)
	  		//window.location.replace("../index.html")
	  }
	  else 
	  {
	  	alert(postRequest.responseText)
	  }
	}

	postRequest.send()
}

function populatePage(requestData)
{
	json = JSON.parse(requestData);
	username = json.username;
	isTrialPeriod = json.isTrialPeriod
	var classCounter = 0
	
	document.getElementById("username").value = username;
	document.getElementById("fname").value = json.fname;
	document.getElementById("lname").value = json.lname;
	document.getElementById("phone").value = json.phone;
	document.getElementById("email").value = json.email;
	document.getElementById("waiver").value = json.waiverSignedDate;
	document.getElementById("payment").value = json.nextPayment;
	document.getElementById("credits").value = json.paidLiveCredits;

	//Fill out Payment History
	livePaymentList = json.paymentHistory
	var table = document.getElementById("paymentHistory");
	if(livePaymentList.length > 0)
	{
		document.getElementById("paymentHistory").style.display = "block"
	}
	for (var i = 0, l = livePaymentList.length; i < l; i++) 
	{		
		var obj = livePaymentList[i];
		amount = obj.amount
		transaction_date = obj.transaction_date
		credits = 1
		if(amount == 35)
		{
			credits = 4
		}

		row = table.insertRow(i +1)
		row.insertCell(0).innerHTML = transaction_date;
		row.insertCell(1).innerHTML = amount;
		row.insertCell(2).innerHTML = credits;
	}

	//Fill out Live Class Attendance History
	classHistoryList = json.classHistory
	var streamTable = document.getElementById("streamHistory");
	if(classHistoryList.length > 0)
	{
		document.getElementById("streamHistory").style.display = "block"
	}
	for (var i = 0, l = classHistoryList.length; i < l; i++) 
	{		
		classCounter = i + 1

		var obj = classHistoryList[i];
		classdate = obj.classdate
		class_time = obj.class_time
		class_type = obj.class_type
		class_name = obj.class_name

		row = streamTable.insertRow(i +1)
		row.insertCell(0).innerHTML = classdate;
		row.insertCell(1).innerHTML = class_time;
		row.insertCell(2).innerHTML = class_type;
		row.insertCell(3).innerHTML = class_name;
	}
	document.getElementById("classHistoryHeader").textContent = "Class History: " + classCounter + " Taken"
	makeTableScroll("streamHistory")


	isActive = json.isActiveForStream;

	if(isActive == false)
	{
		hasWaiver = false;
		if(json.waiverSignedDate != null)
		{
			hasWaiver = true;
		}

		hasCurrentPayment = false;
		if(json.isPaymentCurrent == "ACTIVE")
		{
			hasCurrentPayment = true
		}

		if(hasWaiver == false && hasCurrentPayment == false && isTrialPeriod == false)
		{
			document.getElementById("status").textContent="Account Status: Inactive (No Waiver on Record, No Current Payment)"
			document.getElementById("waiver-link").style.display = "block"
			document.getElementById("waiver-link").setAttribute("align", "center")
		}
		else if(hasWaiver == true && hasCurrentPayment == false && isTrialPeriod == false)
		{
			document.getElementById("status").textContent="Account Status: Inactive (Waiver Signed, No Current Payment)"
		}
		else if(hasWaiver == false && hasCurrentPayment == true)
		{
			document.getElementById("status").textContent="Account Status: Inactive (No Waiver on Record)"
			document.getElementById("waiver-link").style.display = "block"
			document.getElementById("waiver-link").setAttribute("align", "center")
		}
		else if(hasWaiver == false && hasCurrentPayment == false && isTrialPeriod == true)
		{
			document.getElementById("status").textContent="Account Status: 1 Week Trial Free Trial. Please Sign Waiver."
			document.getElementById("waiver-link").style.display = "block"
			document.getElementById("waiver-link").setAttribute("align", "center")
		}
	}
	else
	{
		if (isTrialPeriod == true)
		{
			document.getElementById("status").textContent="Account Status: 1 Week Trial Period - Active For Streaming"
		}
		else
		{
			document.getElementById("status").textContent="Account Status: Active For Streaming"
		}
		document.getElementById("streaming-link").style.display = "block"
	}
  	
}

function signOut()
{
	document.cookie = 'auth=' + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
	window.location.replace("index.html");
}
</script>

	</body>
</html>