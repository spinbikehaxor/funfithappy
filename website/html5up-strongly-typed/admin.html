<!DOCTYPE HTML>
<!--
	Strongly Typed by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Administration</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<script src="https://www.google.com/recaptcha/api.js"></script>
		<style>
			<style>
			input[type="checkbox"] {
		  display:none;
		}
		input[type="checkbox"] + label::before {
		  width: 20px;
		  height: 20px;
		  border-radius: 20px;
		  border: 2px solid #8cad2d;
		  background-color: #fff;
		  display: block;
		  content: "";
		  float: left;
		  margin-right: 5px;
		}
		input[type="checkbox"]:checked+label::before {
		  box-shadow: inset 0px 0px 0px 3px #fff;
		  background-color: #8cad2d;

		  /* class applies to select element itself, not a wrapper element */
.select-css {
    display: block;
    font-size: 16px;
    font-family: sans-serif;
    font-weight: 700;
    color: #444;
    line-height: 1.3;
    padding: .6em 1.4em .5em .8em;
    width: 100%;
    max-width: 100%; /* useful when width is set to anything other than 100% */
    box-sizing: border-box;
    margin: 0;
    border: 1px solid #aaa;
    box-shadow: 0 1px 0 1px rgba(0,0,0,.04);
    border-radius: .5em;
    -moz-appearance: none;
    -webkit-appearance: none;
    appearance: none;
    background-color: #fff;
    /* note: bg image below uses 2 urls. The first is an svg data uri for the arrow icon, and the second is the gradient. 
        for the icon, if you want to change the color, be sure to use `%23` instead of `#`, since it's a url. You can also swap in a different svg icon or an external image reference
        
    */
    background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23007CB2%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'),
      linear-gradient(to bottom, #ffffff 0%,#e5e5e5 100%);
    background-repeat: no-repeat, repeat;
    /* arrow icon position (1em from the right, 50% vertical) , then gradient position*/
    background-position: right .7em top 50%, 0 0;
    /* icon size, then gradient */
    background-size: .65em auto, 100%;
}
/* Hide arrow icon in IE browsers */
.select-css::-ms-expand {
    display: none;
}
/* Hover style */
.select-css:hover {
    border-color: #888;
}
/* Focus style */
.select-css:focus {
    border-color: #aaa;
    /* It'd be nice to use -webkit-focus-ring-color here but it doesn't work on box-shadow */
    box-shadow: 0 0 1px 3px rgba(59, 153, 252, .7);
    box-shadow: 0 0 0 3px -moz-mac-focusring;
    color: #222; 
    outline: none;
}

/* Set options to normal weight */
.select-css option {
    font-weight:normal;
}

/* Support for rtl text, explicit support for Arabic and Hebrew */
*[dir="rtl"] .select-css, :root:lang(ar) .select-css, :root:lang(iw) .select-css {
    background-position: left .7em top 50%, 0 0;
    padding: .6em .8em .5em 1.4em;
}

/* Disabled styles */
.select-css:disabled, .select-css[aria-disabled=true] {
    color: graytext;
    background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22graytext%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'),
      linear-gradient(to bottom, #ffffff 0%,#e5e5e5 100%);
}

.select-css:disabled:hover, .select-css[aria-disabled=true] {
    border-color: #aaa;
}


body {
  margin: 2rem;
}
}
</style>
	</head>
	<body class="no-sidebar is-preload">
		<div id="page-wrapper">

			<!-- Header -->
				<section id="header">
					<div class="container">

						<!-- Logo -->
							<h1 id="logo"><a href="index.html"></a>Annie Cassie Fit</h1>
							<p>Administration</p>

						<!-- Nav -->
							<nav id="nav">
								<ul>
									<li><a class="icon solid fa-home" href="home.html"><span>Home</span></a></li>
									<li><a class="icon solid fa-sitemap" href="user-info.html"><span>Your Account</span></a></li>
									<li><a class="icon solid fa-sitemap" href="admin.html"><span>Administration</span></a></li>
									<li>
										<a href="#" class="icon fa-chart-bar"><span>High Fitness</span></a>
										<ul>
											<li><a href="high-live-list.html">Book a Live Class</a></li>
											<li><a href="high-fitness.html">Online Streaming</a></li>
										</ul>
									</li>
									<li><a class="icon solid fa-retweet" href="boot-camp.html"><span>Boot Camp</span></a></li>
									<li><a class="icon solid fa-sitemap" href="javascript:signOut()"><span>Sign Out</span></a></li>
								</ul>
							</nav>

					</div>
				</section>

			<!-- Main -->
				<section id="main">
					<div class="container">
						<div class="row">
			
								<section>
									<h3> Upcoming Classes </h3>
											<table id="classlist">
											   <tr>
											      <th>Date</th>
											      <th>Time</th>
											      <th>Location</th>
											      <th>Spots Taken</th>
											      <th></th>
											   </tr>
									
											</table>
									<div id="rosterdiv" style="display:none">
										<h3> Class Roster </h3>
										</div>			
								</section>
								
					
						</div>
						<div class="row">
							<div class="col-6 col-12-medium">
								<section>
									<h3>Add New Location</h3>
									<form id="addLocation">
										<div class="row gtr-50">
											<div class="col-6 col-12-small">
												<input name="loc-id" id="loc-id" placeholder="Location ID (i.e. PHMS)" type="text" />
											</div>
											<div class="col-6 col-12-small">
												<input name="address" id="address" placeholder="Address" type="text" />
											</div>
											<div class="col-6 col-12-small">
												<input name="capacity" id="capacity" placeholder="Capacity" type="text" />
											</div>
											<div class="col-6 col-12-small">
												<input name="display-name" id="display-name" placeholder="Display Name" type="text" />
											</div>
											<div class="col-12">
												<a href="javascript:postLocation()" class="form-button-submit button icon solid fa-envelope">Submit</a>
											</div>
	
										</div>
									</form>
									<p>
									<h3>Add Live Class</h3>
									<form id="addClass">
										<div class="row gtr-50">
											<div class="col-6 col-12-small">
												<input name="classdate" id="newclassdate" placeholder="Class Date (2020-08-20)" type="text" maxlength="10"/>
											</div>
											<div class="col-6 col-12-small">
												<select name="location" id="classlocation" placeholder="Location">
													<option value="placeholder" disabled selected>Pick Location</option>
												</select>
											</div>
											<div class="col-6 col-12-small">
												<input name="classtime" id="newclasstime" placeholder="Class Time (i.e. 17:00)" type="text"  maxlength="5"/>
											</div>
											<div class="col-6 col-12-small">
												<input type="checkbox" id="isFree" name="isFree" value="True" />
												<label for="isFree">Free Class</label>
											</div>
											<div class="col-6 col-12-small">
												<input name="postdate" id="postdate" placeholder="Post Date (2020-08-20)" type="text" maxlength="10" />
											</div>
											<div class="col-6 col-12-small">
												<input name="posttime" id="posttime" placeholder="Post Time (i.e. 17:00)" type="text" maxlength="5" />
											</div>
											<div class="col-12">
												<a href="javascript:postLiveCLass()" class="form-button-submit button icon solid fa-envelope">Submit</a>
											</div>
	
										</div>
									</form>
									<p>
									<h3>Queue Next High Video</h3>
									<form id="stageVideo">
										<div class="row gtr-50">
											<div class="col-6 col-12-small">
												<input name="videoURL" id="videoURL" placeholder="Video URL" type="text" />
											</div>
											<div class="col-6 col-12-small">
												<iframe id="testVideoFrame" src="" frameborder="0" allow="autoplay; fullscreen" allowfullscreen style="display:none"></iframe>
											</div>
											<div class="col-12">
												<a href="javascript:testVideo()" class="form-button-submit button icon solid fa-envelope">Test Video</a>
											</div>
											<div class="col-12">
												<a href="javascript:saveVideo()" class="form-button-submit button icon solid fa-envelope">Save Video Link</a>
											</div>
										</div>
									</form>
									<p>
									<h3>Adjust Streaming Times</h3>
									<table id="streamlist">
											   <tr>
											      <th>Day</th>
											      <th>Time</th>
											      <th></th>
											   </tr>
											</table>
									<h3>Add New Streaming Time</h3>
									<form id="addStreamTime">
									<div class="row gtr-50">
										<div class="col-6 col-12-small">
												<select name="streamDay" id="streamDay">
													<option value="placeholder" disabled selected>Pick Day Of Week</option>
													<option value="Sunday">Sunday</option>
													<option value="Monday">Monday</option>
													<option value="Tuesday">Tuesday</option>
													<option value="Wednesday">Wednesday</option>
													<option value="Thursday">Thursday</option>
													<option value="Friday">Friday</option>
													<option value="Saturday">Saturday</option>
												</select>
										</div>
										<div class="col-6 col-12-small">
												<input name="streamtime" id="streamtime" placeholder="Class Time (i.e. 17:00)" type="text" maxlength="5" />
										</div>		
									
									<div class="col-6 col-12-small">
										<a href="javascript:createStreamingTime()" class="form-button-submit button icon solid fa-envelope">Save Stream Time</a>
									</div>
									</div>
								</form>
								</section>
							</div>
					</div>
				</section>

			<!-- Footer -->
				
					<div id="copyright" class="container">
						<ul class="links">
							<li>&copy; Annie Cassie Fit. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
						</ul>
					</div>
				</section>

		</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.dropotron.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

<script>
window.onload= getAdminData()


function testVideo()
{
	url = document.getElementById("videoURL").value;
	frame = document.getElementById("testVideoFrame")
	frame.src= url
	frame.style.display = "block"
}

function saveVideo()
{
	var postRequest = new XMLHttpRequest()

	var data = {
  		"url" : document.getElementById("videoURL").value
	};

	postRequest.open('POST', 'https://joh8lgdanl.execute-api.us-east-2.amazonaws.com/default/any', true)
	postRequest.setRequestHeader('Content-type', 'application/json;charset=UTF-8');
	postRequest.setRequestHeader('X-Api-Key', parseCookie())
	
	postRequest.onload = function () 
	{
	  // Begin accessing JSON data here
	  var responseData = JSON.parse(this.response)

	  if (postRequest.status >= 200 && postRequest.status < 400) 
	  {
	  		alert("Video Saved!")
	  		//window.location.reload()
	  }
	  else 
	  {
	  	alert(postRequest.responseText)
	  }
	}

	postRequest.send(JSON.stringify(data))

}


function dateInputMask(elm) {
  elm.addEventListener('keypress', function(e) {
    if(e.keyCode < 47 || e.keyCode > 57) {
      e.preventDefault();
    }
    
    var len = elm.value.length;
    
    // If we're at a particular place, let the user type the slash
    // i.e., 12/12/1212
    if(len !== 1 || len !== 3) {
      if(e.keyCode == 47) {
        e.preventDefault();
      }
    }
    
    // If they don't add the slash, do it for them...
    if(len === 4) {
      elm.value += '-';
    }

    // If they don't add the slash, do it for them...
    if(len === 7) {
      elm.value += '-';
    }
  });
};

function timeInputMask(elm)
{
	 elm.addEventListener('keypress', function(e) 
	 {
	    if(e.keyCode < 47 || e.keyCode > 57) 
	    {
	      e.preventDefault();
	    }
    
    	var len = elm.value.length;
    
	    // If we're at a particular place, let the user type the slash
	    // i.e., 12/12/1212
	    if(len !== 1 || len !== 3) 
	    {
	      if(e.keyCode == 47) 
	      {
	        e.preventDefault();
	      }
	    }
    
	    // If they don't add the slash, do it for them...
	    if(len === 2) 
	    {
	      elm.value += ':';
	    }
   
  	});
};


async function processRequest()
{
	const data = await sendRequest();
	alert("processrequest data: " + data);
}

function parseCookie()
{
	jwt = document.cookie.split('; ')
  	.find(row => row.startsWith('auth'))
  	.split('=')[1];

  	return jwt;
}

function getAdminData()
{
	//Check if logged in
	if(document.cookie.length == 0)
	{
		window.location.replace("sign-in.html")
	}

	dateInputMask(newclassdate);
	dateInputMask(postdate);
	timeInputMask(newclasstime);
	timeInputMask(streamtime);
	timeInputMask(posttime);

	var postRequest = new XMLHttpRequest()
	postRequest.open('POST', 'https://iqtl1ffmkd.execute-api.us-east-2.amazonaws.com/default/any', true)
	postRequest.setRequestHeader('Content-type', 'application/json;charset=UTF-8');
	postRequest.setRequestHeader('X-Api-Key', parseCookie())

	postRequest.onload = function () 
	{
	  // Begin accessing JSON data here
	  var responseData = JSON.parse(this.response)

	  if (postRequest.status >= 200 && postRequest.status < 400) 
	  {
	  		//alert("success! " + postRequest.responseText)
	  		populatePage(postRequest.responseText)
	  		//window.location.replace("../index.html")
	  }
	  else if(postRequest.status == 401)
	  {
	  		window.location.replace("home.html")
	  }
	  else 
	  {
	  	alert(postRequest.responseText)
	  }
	}
	postRequest.send()
}

function populatePage(requestData)
{
	json = JSON.parse(requestData);
	locations = json.locations;
	classes = json.classes;
	streamingTimes = json.streamingTimes;

	//populate the locations
	var locSelect = document.getElementById("classlocation")
	for (var i = 0, l = locations.length; i < l; i++) 
	{
		var opt = document.createElement('option');
		opt.id = locations[i].locId
    	opt.value = locations[i].locId
    	opt.innerHTML = locations[i].display_name + " (" + locations[i].capacity + ")";
    	locSelect.appendChild(opt);
	}
	//populate streaming times
	var streamTable = document.getElementById("streamlist")
	for (var i = 0, l = streamingTimes.length; i < l; i++) 
	{
		var obj = streamingTimes[i];
		dayOfWeek = obj.dayOfWeek
		timeOfDay = obj.timeOfDay

		streamId = dayOfWeek + "/" + timeOfDay
		row = streamTable.insertRow(i +1)
		row.insertCell(0).innerHTML = dayOfWeek;
		row.insertCell(1).innerHTML = timeOfDay;
		row.insertCell(2).innerHTML = "<button type='button' id='" + streamId +"' onclick='deleteStreamingTime(this)'>Delete</button>";
	}

	//Populate the classlist
	var table = document.getElementById("classlist");
	for (var i = 0, l = classes.length; i < l; i++) 
	{		
		var obj = classes[i];
		classdate = obj.class_date
		
		time = obj.class_time
		spots_taken = obj.spots_taken
		class_location = obj.location
		roster = obj.roster;

		var classDiv = document.createElement("div")
		classDiv.id = classdate + "Div"
		classDiv.name = classdate + "Div"
		classDiv.style = "display:none"

		var header = document.createElement("h3") 
		header.innerText = classdate
		var tbl = document.createElement("table");
		tbl.id = classdate
		rosterheader = tbl.insertRow(0)
		rosterheader.insertCell(0).innerHTML = "Username";
		rosterheader.insertCell(1).innerHTML = "Spot Number";
		rosterheader.insertCell(2).innerHTML = "Waitlist Number";

		for (var k = 0, m = roster.length; k < m; k++) 
		{	
			var signup = roster[k];
			rosterrow = tbl.insertRow(k +1)

			rosterrow.insertCell(0).innerHTML = signup['username'];
			rosterrow.insertCell(1).innerHTML = signup['spot_number'];
			rosterrow.insertCell(2).innerHTML = signup['waitlist_number'];
		}

		classDiv.appendChild(header)
		classDiv.appendChild(tbl)
		document.getElementById('rosterdiv').appendChild(classDiv)
		//document.getElementById('rosterdiv').appendChild(tbl)

		row = table.insertRow(i +1)
		row.insertCell(0).innerHTML = classdate;
		row.insertCell(1).innerHTML = time;
		row.insertCell(2).innerHTML = class_location;
		row.insertCell(3).innerHTML = spots_taken;
		row.insertCell(4).innerHTML = "<button type='button' id='" + classdate +"Button' onclick='viewRoster(this)'>View Class Roster</button>";
	}
}

function viewRoster(classbutton)
{	
	classdate = classbutton.id
	classdatesplit = classdate.split("B")
	divId = classdatesplit[0]+"Div"

	if(classbutton.innerText == "HIDE CLASS ROSTER")
	{
		classbutton.innerText = "VIEW CLASS ROSTER"
		document.getElementById(divId).style.display = "none"
		document.getElementById('rosterdiv').style.display = "none"
	}
	else
	{
		classbutton.innerText = "HIDE CLASS ROSTER"
		document.getElementById('rosterdiv').style.display = "block"
		document.getElementById(divId).style.display = "block"
	}
		
}

function postLiveCLass()
{
	var postRequest = new XMLHttpRequest()

	var isFreeString = "False"
	var isFree = document.getElementById('isFree').checked 
	if (isFree == true)
	{
		isFreeString = "True"
	}

	var data = {
  		"class_date"		: document.getElementById('newclassdate').value,
  		"class_time"		: document.getElementById('newclasstime').value,
  		"location"			: document.getElementById('classlocation').value,
  		"isFree"			: isFreeString,
  		"post_date"			: document.getElementById('postdate').value,
  		"post_time"			: document.getElementById('posttime').value,
	};

	postRequest.open('POST', 'https://716b9237t4.execute-api.us-east-2.amazonaws.com/default/any', true)
	postRequest.setRequestHeader('Content-type', 'application/json;charset=UTF-8');
	postRequest.setRequestHeader('X-Api-Key', parseCookie())
	
	postRequest.onload = function () 
	{
	  // Begin accessing JSON data here
	  var responseData = JSON.parse(this.response)

	  if (postRequest.status >= 200 && postRequest.status < 400) 
	  {
	  		alert("Class Saved!")
	  		window.location.reload()
	  }
	  else 
	  {
	  	alert(postRequest.responseText)
	  }
	}

	postRequest.send(JSON.stringify(data))
}

	

function postLocation()
{
	var postRequest = new XMLHttpRequest()

	var data = {
  		"id"				: document.getElementById('loc-id').value,
  		"address"			: document.getElementById('address').value,
  		"capacity"			: document.getElementById('capacity').value,
  		"display-name"		: document.getElementById('display-name').value
	};

	postRequest.open('POST', 'https://kxqlffj68k.execute-api.us-east-2.amazonaws.com/default/any', true)
	postRequest.setRequestHeader('Content-type', 'application/json;charset=UTF-8');
	postRequest.setRequestHeader('X-Api-Key', parseCookie())
	
	postRequest.onload = function () 
	{
	  // Begin accessing JSON data here
	  var responseData = JSON.parse(this.response)

	  if (postRequest.status >= 200 && postRequest.status < 400) 
	  {
	  		alert("Location Saved!")
	  		window.location.reload()
	  }
	  else 
	  {
	  	alert(postRequest.responseText)
	  }
	}

	postRequest.send(JSON.stringify(data))
}


function deleteStreamingTime(streamingTime)
{
	streamingTimeData = streamingTime.id
	url = "https://uhfabqv5tj.execute-api.us-east-2.amazonaws.com/default/any"
	var postRequest = new XMLHttpRequest()

	data = {
		"streamDateTime" : streamingTimeData
	}

	postRequest.open('POST', url, true)
	postRequest.setRequestHeader('Content-type', 'application/json;charset=UTF-8');
	postRequest.setRequestHeader('X-Api-Key', parseCookie())

	postRequest.onload = function () 
	{
	  // Begin accessing JSON data here
	  var responseData = JSON.parse(this.response)

	  if (postRequest.status >= 200 && postRequest.status < 400) 
	  {
	  		alert("Streaming Time Deleted!")
	  		window.location.reload()
	  }
	  else 
	  {
	  	alert(postRequest.responseText)
	  }
	}
	postRequest.send(JSON.stringify(data))
}

function createStreamingTime()
{
	url = "https://y1ce0z6lc4.execute-api.us-east-2.amazonaws.com/default/any"
	var postRequest = new XMLHttpRequest()

	streamDay = document.getElementById('streamDay').value
	streamTime = document.getElementById('streamtime').value
	streamDayTime = streamDay + "/" + streamTime

	var data = {
  		"streamDateTime"		: streamDayTime
	};

	postRequest.open('POST', url, true)
	postRequest.setRequestHeader('Content-type', 'application/json;charset=UTF-8');
	postRequest.setRequestHeader('X-Api-Key', parseCookie())

	postRequest.onload = function () 
	{
	  // Begin accessing JSON data here
	  var responseData = JSON.parse(this.response)

	  if (postRequest.status >= 200 && postRequest.status < 400) 
	  {
	  		alert("Streaming Time Created!")
	  		document.getElementById("streamDay").options[0].selected = true
	  		document.getElementById('streamtime').value = ""
	  		window.location.reload()
	  }
	  else 
	  {
	  	alert(postRequest.responseText)
	  }
	}
	postRequest.send(JSON.stringify(data))
}



   function onSubmit(token) {
     javascript:xmlRequest()
   }

function signOut()
{
	document.cookie = 'auth=' + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
	window.location.replace("index.html");
}

</script>

	</body>
</html>